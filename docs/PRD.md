# 产品需求文档 (PRD) — 碰个头 (OnTheWay)

> 版本：v0.1.0 | 最后更新：2025-02

---

## 1. 产品定位

### 一句话描述

**碰个头** — 解决多人聚餐"去哪吃"决策难题的协调工具。

### 问题场景

朋友聚餐时，最痛苦的不是吃什么，而是**定去哪吃**：

- 每个人在不同的地方，谁迁就谁？
- 口味偏好不同，众口难调
- 群里讨论半天，最后还是"随便"
- 定了地点，有人迟到，有人找不到路
- 没人知道其他人到哪了，干等着焦虑

### 解决方案

提供一个从**决策到到达**的全流程协调工具：

1. **信息收集**：每个人填写位置和口味偏好
2. **智能推荐**：AI 综合所有人信息，推荐最优餐厅
3. **民主决策**：投票确认，避免一言堂
4. **出行协调**：计算出发时间，实时追踪，智能催促

---

## 2. 目标用户

### 核心用户画像

- **年龄**：20-35 岁
- **场景**：3-10 人朋友聚餐
- **频率**：每月 1-4 次
- **特征**：
  - 社交活跃，经常组织或参与聚餐
  - 习惯使用手机协调事务
  - 对"选择困难"有共鸣

### 用户角色

| 角色 | 说明 | 核心需求 |
|------|------|----------|
| **发起人** | 创建聚会的人 | 快速创建、方便分享、掌控进度 |
| **参与者** | 被邀请加入的人 | 简单加入、表达偏好、知道何时出发 |

---

## 3. 核心场景

### 完整用户旅程

```
发起人创建聚会
    ↓ 设定时间、位置偏好
    ↓ 获得 6 位邀请码
    ↓
分享邀请码给朋友（微信/复制）
    ↓
朋友们加入聚会
    ↓ 填写昵称、当前位置、口味偏好
    ↓
发起人触发 AI 推荐
    ↓ AI 综合所有人位置 + 口味
    ↓ 返回 3 个推荐餐厅（含理由）
    ↓
投票确认餐厅
    ↓ 发起人选择一个餐厅发起投票
    ↓ 参与者同意/反对
    ↓ 多数通过 → 确认餐厅
    ↓
系统计算出发时间
    ↓ 根据每个人的位置和交通方式
    ↓ 计算需要出发的时间
    ↓
出发追踪
    ↓ 每个人标记"已出发"
    ↓ 实时显示所有人状态
    ↓ 该出发未出发 → 智能催促
    ↓
标记到达
    ↓ 每个人到达后标记
    ↓
全员到达 → 聚会完成 🎉
```

### 关键场景细节

#### 场景 1：创建聚会

- 发起人打开应用，点击"发起聚会"
- 填写：聚会名称、目标时间、大致区域偏好（可选）、自己的口味偏好
- 系统生成 6 位邀请码（如 `A3K9F2`）
- 发起人复制邀请码或直接分享

#### 场景 2：加入聚会

- 参与者输入邀请码（或点击分享链接）
- 填写：昵称、当前位置（地图选点或搜索）、口味偏好（多选标签）
- 加入成功，看到当前聚会状态和已加入的人

#### 场景 3：AI 推荐

- 发起人点击"开始推荐"
- 系统将所有人的位置和口味偏好发送给 AI
- AI 返回 3 个推荐餐厅，每个包含：
  - 餐厅名称、地址、菜系
  - 推荐理由（为什么适合这群人）
  - 每个人到餐厅的预估距离/时间
- 所有参与者实时看到推荐结果

#### 场景 4：投票

- 发起人选择一个餐厅发起投票
- 每个参与者可以投"同意"或"反对"
- 超过半数同意 → 餐厅确认
- 全部反对 → 可重新推荐或选择其他餐厅

#### 场景 5：出发追踪

- 餐厅确认后，系统计算每个人的建议出发时间
- 到了出发时间，提醒用户出发
- 用户点击"已出发"更新状态
- 所有人可以看到彼此的状态：未出发 / 已出发 / 已到达
- 超时未出发 → 显示催促消息

---

## 4. 功能列表

### P0 — 核心功能（MVP）

| 编号 | 功能 | 说明 |
|------|------|------|
| P0-1 | 创建聚会 | 填写名称、时间，生成邀请码 |
| P0-2 | 加入聚会 | 输入邀请码，填写位置和口味 |
| P0-3 | AI 推荐餐厅 | 综合所有人信息，推荐 3 个餐厅 |
| P0-4 | 投票确认 | 对推荐餐厅投票，多数通过 |
| P0-5 | 出发追踪 | 标记出发/到达，实时状态显示 |
| P0-6 | 智能催促 | 超时未出发显示催促消息 |
| P0-7 | 游客模式 | 无需注册，输入昵称即可使用 |

### P1 — 增强功能

| 编号 | 功能 | 说明 |
|------|------|------|
| P1-1 | 暗色模式 | 温暖色调的暗色主题 |
| P1-2 | 聚会历史 | 查看过去参与的聚会记录 |
| P1-3 | 微信小程序 | 小程序端完整功能 |
| P1-4 | 地图可视化 | 在地图上显示所有人位置和餐厅 |
| P1-5 | 分享卡片 | 生成好看的聚会分享图片 |

### P2 — 扩展功能

| 编号 | 功能 | 说明 |
|------|------|------|
| P2-1 | 微信扫码登录 | Web 端微信扫码登录 |
| P2-2 | 订阅消息推送 | 小程序订阅消息通知 |
| P2-3 | 收藏餐厅 | 收藏喜欢的餐厅，下次推荐优先 |
| P2-4 | 聚会模板 | 保存常用聚会配置，一键复用 |
| P2-5 | 费用 AA | 聚餐后 AA 分账 |

---

## 5. 用户流程图

### 主流程

```
┌─────────────┐
│   打开应用   │
└──────┬──────┘
       │
       ├──── 有邀请码 ────→ 输入邀请码 → 加入聚会流程
       │
       └──── 无邀请码 ────→ 创建聚会流程
```

### 创建聚会流程

```
创建聚会
  │
  ├─ 1. 填写聚会名称
  ├─ 2. 选择目标时间
  ├─ 3. 填写自己的位置（地图选点）
  ├─ 4. 选择口味偏好（标签多选）
  │
  ↓
生成邀请码 → 进入聚会等待页
  │
  ├─ 分享邀请码给朋友
  ├─ 实时显示已加入的人
  │
  ↓ （人齐了）
  │
点击"开始推荐"
  │
  ↓
AI 返回 3 个推荐餐厅
  │
  ├─ 查看每个餐厅详情
  ├─ 选择一个发起投票
  │
  ↓
投票进行中
  │
  ├─ 通过 → 餐厅确认 → 进入出发追踪
  └─ 未通过 → 选择其他餐厅 / 重新推荐
```

### 加入聚会流程

```
输入邀请码
  │
  ├─ 1. 填写昵称
  ├─ 2. 选择当前位置（地图选点）
  ├─ 3. 选择口味偏好（标签多选）
  │
  ↓
加入成功 → 进入聚会页面
  │
  ├─ 等待推荐 → 查看推荐结果 → 参与投票
  ├─ 餐厅确认后 → 查看出发时间 → 标记出发 → 标记到达
  │
  ↓
全员到达 → 聚会完成
```

### 出发追踪流程

```
餐厅确认
  │
  ↓
系统计算每个人的建议出发时间
  │
  ↓
等待出发
  │
  ├─ 到出发时间 → 提醒出发
  ├─ 用户点击"已出发" → 状态更新为"出发中"
  ├─ 超时未出发 → 显示催促消息
  │
  ↓
用户点击"已到达" → 状态更新为"已到达"
  │
  ↓
全员到达 → 聚会状态变为"已完成"
```

---

## 6. 非功能需求

| 维度 | 要求 |
|------|------|
| **性能** | 页面加载 < 2s，API 响应 < 500ms |
| **并发** | 支持单聚会 10 人同时在线 |
| **可用性** | 游客模式零门槛，核心流程 3 步内完成 |
| **兼容性** | Web 支持 Chrome/Safari/微信内置浏览器；小程序支持 iOS/Android |
| **安全** | 聚会数据仅参与者可见，邀请码有效期 24 小时 |

---

## 7. 数据指标

### 核心指标

- **聚会完成率**：创建聚会 → 全员到达的转化率
- **加入转化率**：收到邀请码 → 成功加入的比例
- **推荐采纳率**：AI 推荐 → 投票通过的比例

### 次要指标

- 平均每聚会参与人数
- 从创建到全员到达的平均时长
- 用户复访率（再次创建/加入聚会）

---

## 8. 里程碑

| 阶段 | 目标 | 时间 |
|------|------|------|
| Phase 1 | 项目基础设施搭建 | 第 1 周 |
| Phase 2 | 核心聚会流程（创建/加入/推荐/投票） | 第 2 周 |
| Phase 3 | 出发追踪 + 实时功能 + 暗色模式 | 第 3 周 |
| Phase 4 | 微信小程序 | 第 4 周 |
| Phase 5 | 优化打磨 + 部署上线 | 第 5 周 |
