# äº§å“éœ€æ±‚æ–‡æ¡£ (PRD) â€” ç¢°ä¸ªå­— (OnTheWay) v2

> ç‰ˆæœ¬ï¼šv2.0.0 | æœ€åæ›´æ–°ï¼š2026-02

---

## 1. äº§å“å®šä½

### ä¸€å¥è¯æè¿°

**ç¢°ä¸ªå­—** â€” èšä¼šå…¨æµç¨‹é¡¹ç›®ç®¡ç†ï¼šä»å‘èµ·åˆ°åˆ°è¾¾ã€‚æ¯ä¸ªäººéƒ½èƒ½æåé¤å…ï¼Œæ°‘ä¸»æŠ•ç¥¨ï¼Œåè°ƒå‡ºå‘ã€‚

### é—®é¢˜åœºæ™¯

æœ‹å‹èšé¤æ—¶ï¼Œæœ€ç—›è‹¦çš„ä¸æ˜¯åƒä»€ä¹ˆï¼Œè€Œæ˜¯**å®šå»å“ªåƒ**ï¼š

- æ¯ä¸ªäººåœ¨ä¸åŒçš„åœ°æ–¹ï¼Œè°è¿å°±è°ï¼Ÿ
- å£å‘³åå¥½ä¸åŒï¼Œä¼—å£éš¾è°ƒ
- ç¾¤é‡Œè®¨è®ºåŠå¤©ï¼Œæœ€åè¿˜æ˜¯"éšä¾¿"
- å®šäº†åœ°ç‚¹ï¼Œæœ‰äººè¿Ÿåˆ°ï¼Œæœ‰äººæ‰¾ä¸åˆ°è·¯
- æ²¡äººçŸ¥é“å…¶ä»–äººåˆ°å“ªäº†ï¼Œå¹²ç­‰ç€ç„¦è™‘

### è§£å†³æ–¹æ¡ˆ

æä¾›ä¸€ä¸ªä»**å†³ç­–åˆ°åˆ°è¾¾**çš„å…¨æµç¨‹åè°ƒå·¥å…·ï¼š

1. **ä¿¡æ¯æ”¶é›†**ï¼šæ¯ä¸ªäººå¡«å†™ä½ç½®ï¼ˆå£å‘³ä»…åœ¨éœ€è¦ AI æ¨èæ—¶å¡«å†™ï¼‰
2. **æ°‘ä¸»æå**ï¼šæ¯äººå¯æå 1-2 å®¶é¤å…ï¼ˆæ‰‹åŠ¨æœç´¢æˆ– AI æ¨èï¼‰
3. **æŠ•ç¥¨å†³ç­–**ï¼šä»æ‰€æœ‰æåä¸­é€‰æ‹©æœ€å–œæ¬¢çš„ï¼Œå°‘æ•°æœä»å¤šæ•°
4. **å‡ºè¡Œåè°ƒ**ï¼šè®¡ç®—å‡ºå‘æ—¶é—´ï¼Œå®æ—¶è¿½è¸ªï¼Œæ™ºèƒ½å‚¬ä¿ƒ

---

## 2. æ ¸å¿ƒç”¨æˆ·ä¸è§’è‰²

### ç”¨æˆ·ç”»åƒ

- **å¹´é¾„**ï¼š20-35 å²
- **åœºæ™¯**ï¼š3-10 äººæœ‹å‹èšé¤
- **é¢‘ç‡**ï¼šæ¯æœˆ 1-4 æ¬¡
- **ç‰¹å¾**ï¼š
  - ç¤¾äº¤æ´»è·ƒï¼Œç»å¸¸ç»„ç»‡æˆ–å‚ä¸èšé¤
  - ä¹ æƒ¯ä½¿ç”¨æ‰‹æœºåè°ƒäº‹åŠ¡
  - å¯¹"é€‰æ‹©å›°éš¾"æœ‰å…±é¸£

### ç”¨æˆ·è§’è‰²

| è§’è‰² | è¯´æ˜ | æ ¸å¿ƒéœ€æ±‚ | v2 å˜åŒ– |
|------|------|----------|---------|
| **å‘èµ·äºº (Creator)** | åˆ›å»ºèšä¼šã€åˆ†äº«é‚€è¯·ç ã€æŒæ§è¿›åº¦ | å¿«é€Ÿåˆ›å»ºã€æ–¹ä¾¿åˆ†äº«ã€æŒæ§è¿›åº¦ | ä¸å†ç‹¬å æ¨èæƒï¼Œä¸å‚ä¸è€…å¹³ç­‰æå |
| **å‚ä¸è€… (Participant)** | åŠ å…¥èšä¼šã€æåé¤å…ã€æŠ•ç¥¨ã€å‡ºå‘åˆ°è¾¾ | ç®€å•åŠ å…¥ã€è¡¨è¾¾åå¥½ã€çŸ¥é“ä½•æ—¶å‡ºå‘ | æ–°å¢ï¼šå¯ä¸»åŠ¨æåé¤å…ï¼ˆæ‰‹åŠ¨/AIï¼‰ |

---

## 3. ç”¨æˆ·é“¾è·¯

### ä¸»æµç¨‹

```
åˆ›å»ºèšä¼š â†’ åˆ†äº«é‚€è¯· â†’ åŠ å…¥èšä¼šï¼ˆæ˜µç§°+è‡ªåŠ¨å®šä½ï¼‰
    â†’ æåé¤å…ï¼ˆæ‰‹åŠ¨æŒ‡å®š / AIæ¨èï¼‰â†’ æŠ•ç¥¨ç¡®è®¤
    â†’ å‡ºå‘ç®¡ç† â†’ åˆ°è¾¾å®Œæˆ
```

---

### 3.1 åˆ›å»ºèšä¼š

#### åœºæ™¯æè¿°

å‘èµ·äººæ‰“å¼€åº”ç”¨ï¼Œç‚¹å‡»"å‘èµ·èšä¼š"ï¼Œå¡«å†™èšä¼šåç§°å’Œç›®æ ‡æ—¶é—´ï¼Œç³»ç»Ÿç”Ÿæˆ 6 ä½é‚€è¯·ç ã€‚v2 å˜åŒ–ï¼š**åˆ›å»ºæ—¶ä¸å†è¦æ±‚å¡«å†™å£å‘³åå¥½**ï¼Œå£å‘³ä»…åœ¨ AI æ¨èæ—¶æŒ‰éœ€å¡«å†™ã€‚

#### UI éœ€æ±‚

- **é¡µé¢**ï¼š`CreateGatheringPage`ï¼ˆå¯å¤ç”¨ HomePage ä¸­çš„ CreateGatheringCardï¼Œæˆ–ç‹¬ç«‹é¡µé¢ï¼‰
- **è¡¨å•å­—æ®µ**ï¼š
  - èšä¼šåç§°ï¼ˆInputï¼Œ1-50 å­—ç¬¦ï¼Œå¿…å¡«ï¼‰
  - ç›®æ ‡æ—¶é—´ï¼ˆDateTime Pickerï¼Œå¿…å¡«ï¼‰
  - å‘èµ·äººæ˜µç§°ï¼ˆInputï¼Œ1-20 å­—ç¬¦ï¼Œå¯é€‰ï¼Œé»˜è®¤å– profileï¼‰
- **ç§»é™¤**ï¼šå£å‘³åå¥½é€‰æ‹©å™¨ï¼ˆä»åˆ›å»ºæµç¨‹ç§»é™¤ï¼Œç§»è‡³ AI æ¨èé˜¶æ®µï¼‰
- **è‡ªåŠ¨è·å–å®šä½**ï¼šé¡µé¢åŠ è½½æ—¶é™é»˜è·å–æµè§ˆå™¨å®šä½ï¼Œä¸é˜»å¡åˆ›å»ºæµç¨‹
- **åˆ›å»ºæˆåŠŸ**ï¼šè·³è½¬ Dashboardï¼Œæ˜¾ç¤ºé‚€è¯·ç 

#### åç«¯éœ€æ±‚

**API**: `POST /api/gatherings`

è¯·æ±‚ä½“ï¼ˆv2 ç®€åŒ–ï¼‰ï¼š
```typescript
{
  name: string;           // èšä¼šåç§°ï¼Œ1-50 å­—ç¬¦
  target_time: string;   // ISO 8601 æ ¼å¼
  creator_nickname?: string; // åˆ›å»ºè€…æ˜µç§°ï¼ˆå¯é€‰ï¼‰
}
```

å“åº”ä½“ï¼ˆ201ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    id: string;
    code: string;        // 6 ä½é‚€è¯·ç ï¼Œå¦‚ "A3K9F2"
    name: string;
    status: "waiting";
    target_time: string;
    creator_id: string;
    version: number;
    created_at: string;
  }
}
```

é”™è¯¯ç ï¼š`VALIDATION_ERROR` | `AUTH_REQUIRED`

**æ•°æ®åº“æ“ä½œ**ï¼š
- INSERT `gatherings`ï¼ˆstatus='waiting'ï¼‰
- INSERT `participants`ï¼ˆcreator ä½œä¸ºç¬¬ä¸€ä¸ªå‚ä¸è€…ï¼Œtastes é»˜è®¤ä¸ºç©ºæ•°ç»„ï¼‰
- INSERT `messages`ï¼ˆç³»ç»Ÿæ¶ˆæ¯ï¼šèšä¼šå·²åˆ›å»ºï¼‰
- è°ƒç”¨ `bumpVersion()` æ›´æ–°ç‰ˆæœ¬å·

#### å‰ç«¯éœ€æ±‚

- **ç»„ä»¶**ï¼š`CreateGatheringForm`
  - props: æ— 
  - state: `{ name, targetTime, loading, error }`
- **Store Action**: `useGatheringStore.createGathering(params)`
- **API è°ƒç”¨**: `api.createGathering(params)` â†’ æˆåŠŸå `navigate(/dashboard/${code})`
- **ä½ç½®è·å–**: `useLocation(true)` â†’ é™é»˜è°ƒç”¨ `api.updateLocation(code, location)`

#### æµ‹è¯•è¦æ±‚

**å‰ç«¯éªŒæ”¶**ï¼š
- åç§°ä¸ºç©º â†’ æ˜¾ç¤ºé”™è¯¯æç¤º"è¯·è¾“å…¥èšä¼šåç§°"
- ç›®æ ‡æ—¶é—´ä¸ºè¿‡å»æ—¶é—´ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º"è¯·é€‰æ‹©æœªæ¥çš„æ—¶é—´"
- åˆ›å»ºæˆåŠŸ â†’ è·³è½¬ Dashboardï¼Œæ˜¾ç¤ºé‚€è¯·ç 

**åç«¯æµ‹è¯•ç”¨ä¾‹**ï¼š
- `POST /api/gatherings` æ­£å¸¸åˆ›å»º â†’ 201 + è¿”å› gathering å¯¹è±¡
- ç¼ºå°‘ name â†’ 400 VALIDATION_ERROR
- ç¼ºå°‘ target_time â†’ 400 VALIDATION_ERROR
- æœªç™»å½• â†’ 401 AUTH_REQUIRED
- é‚€è¯·ç å”¯ä¸€æ€§ï¼ˆå¹¶å‘åˆ›å»ºä¸å†²çªï¼‰

---

### 3.2 åˆ†äº«é‚€è¯·

#### åœºæ™¯æè¿°

åˆ›å»ºæˆåŠŸåï¼Œå‘èµ·äººåœ¨ Dashboard é¡µé¢çœ‹åˆ°é‚€è¯·ç ï¼Œå¯å¤åˆ¶æˆ–åˆ†äº«ç»™æœ‹å‹ã€‚

#### UI éœ€æ±‚

- **ç»„ä»¶**ï¼š`InviteCodeCard`ï¼ˆæ²¿ç”¨ v1 Sidebar ä¸­çš„é‚€è¯·ç å¡ç‰‡ï¼‰
- **é‚€è¯·ç æ˜¾ç¤ºæ ¼å¼**ï¼š`XXX-XXX`ï¼ˆä¸­é—´åŠ æ¨ªçº¿ï¼Œä¾¿äºé˜…è¯»ï¼‰
- **äº¤äº’**ï¼š
  - ç‚¹å‡»"å¤åˆ¶"â†’ `navigator.clipboard.writeText(code)` â†’ æ˜¾ç¤º"å·²å¤åˆ¶"Toast
  - ç‚¹å‡»"åˆ†äº«"â†’ è°ƒç”¨ Web Share API æˆ–ç”Ÿæˆåˆ†äº«é“¾æ¥ `https://domain/join/{code}`

#### åç«¯éœ€æ±‚

æ— é¢å¤– APIï¼ˆé‚€è¯·ç åœ¨åˆ›å»ºæ—¶å·²ç”Ÿæˆï¼‰

#### å‰ç«¯éœ€æ±‚

- **ç»„ä»¶**ï¼šå¤ç”¨ `Sidebar` ä¸­çš„ InviteCode åŒºåŸŸ
- **æ–°å¢**ï¼š`ShareButton` ç»„ä»¶
  - props: `{ code: string }`
  - è¡Œä¸ºï¼šä¼˜å…ˆ Web Share APIï¼Œé™çº§ä¸ºå¤åˆ¶é“¾æ¥

#### æµ‹è¯•è¦æ±‚

**å‰ç«¯éªŒæ”¶**ï¼š
- ç‚¹å‡»å¤åˆ¶æŒ‰é’® â†’ clipboard å†™å…¥æ­£ç¡®çš„ code â†’ æ˜¾ç¤º"å·²å¤åˆ¶"åé¦ˆ
- åˆ†äº«é“¾æ¥æ ¼å¼æ­£ç¡®ï¼š`https://domain/join/XXX-XXX`

---

### 3.3 åŠ å…¥èšä¼šï¼ˆæ˜µç§° + è‡ªåŠ¨å®šä½ï¼‰

#### åœºæ™¯æè¿°

å‚ä¸è€…é€šè¿‡é‚€è¯·ç æˆ–é“¾æ¥åŠ å…¥èšä¼šã€‚v2 å˜åŒ–ï¼š**åŠ å…¥é—¨æ§›é™ä½ä¸ºä»…éœ€æ˜µç§° + è‡ªåŠ¨å®šä½**ï¼Œä¸å†è¦æ±‚å¡«å†™å£å‘³åå¥½ã€‚

#### UI éœ€æ±‚

- **é¡µé¢**ï¼š`JoinPage`ï¼ˆæ²¿ç”¨ï¼Œç®€åŒ–è¡¨å•ï¼‰
- **è¡¨å•å­—æ®µ**ï¼š
  - é‚€è¯·ç ï¼ˆInputï¼Œå¦‚æœä»é“¾æ¥è¿›å…¥åˆ™è‡ªåŠ¨å¡«å……ï¼‰
  - æ˜µç§°ï¼ˆInputï¼Œ1-20 å­—ç¬¦ï¼Œå¿…å¡«ï¼‰
- **ç§»é™¤**ï¼šå£å‘³åå¥½é€‰æ‹©å™¨ï¼ˆä»åŠ å…¥æµç¨‹ç§»é™¤ï¼‰
- **è‡ªåŠ¨å®šä½**ï¼šé¡µé¢åŠ è½½æ—¶è¯·æ±‚æµè§ˆå™¨å®šä½æƒé™ï¼Œè·å–åé™é»˜ä¸Šä¼ 
- **åŠ å…¥æˆåŠŸ**ï¼šè·³è½¬ Dashboard

#### åç«¯éœ€æ±‚

**API**: `POST /api/gatherings/:code/join`

è¯·æ±‚ä½“ï¼ˆv2 ç®€åŒ–ï¼‰ï¼š
```typescript
{
  nickname: string;        // 1-20 å­—ç¬¦
  location?: {             // å¯é€‰ï¼Œå‰ç«¯è‡ªåŠ¨è·å–
    lng: number;
    lat: number;
  };
  location_name?: string;  // ä½ç½®åç§°ï¼Œå¦‚"å›½è´¸å¤§å¦"
}
```

> æ³¨æ„ï¼šç§»é™¤ `tastes` å­—æ®µã€‚å£å‘³åå¥½ä¸å†åœ¨åŠ å…¥æ—¶æ”¶é›†ã€‚

å“åº”ä½“ï¼ˆ201ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    id: string;
    gathering_id: string;
    user_id: string;
    nickname: string;
    location: { lng: number, lat: number } | null;
    location_name: string | null;
    tastes: string[];      // ç©ºæ•°ç»„
    status: "joined";
    is_creator: boolean;
  }
}
```

é”™è¯¯ç ï¼š
| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| `NOT_FOUND` | é‚€è¯·ç ä¸å­˜åœ¨ |
| `ALREADY_JOINED` | å·²åŠ å…¥è¯¥èšä¼š |
| `GATHERING_FULL` | èšä¼šäººæ•°å·²æ»¡ï¼ˆä¸Šé™ 10 äººï¼‰ |
| `INVALID_STATE` | èšä¼šå·²å®Œæˆæˆ–å·²å…³é—­ |
| `INVALID_NICKNAME` | æ˜µç§°æ ¼å¼ä¸æ­£ç¡® |

**æ•°æ®åº“æ“ä½œ**ï¼š
- INSERT `participants`ï¼ˆtastes é»˜è®¤ä¸ºç©ºæ•°ç»„ `{}`ï¼‰
- INSERT `messages`ï¼ˆç³»ç»Ÿæ¶ˆæ¯ï¼šXXX åŠ å…¥äº†èšä¼šï¼‰
- è°ƒç”¨ `bumpVersion()`

#### å‰ç«¯éœ€æ±‚

- **ç»„ä»¶**ï¼š`JoinGatheringForm`ï¼ˆç®€åŒ–ç‰ˆï¼‰
  - state: `{ code, nickname, loading, error }`
- **ç§»é™¤**ï¼š`TasteSelector` ç»„ä»¶å¼•ç”¨
- **Store Action**: `useGatheringStore.joinGathering(code, nickname)`
- **ä½ç½®è·å–**: `useLocation(true)` â†’ åŠ å…¥æˆåŠŸåè°ƒç”¨ `api.updateLocation`

#### æµ‹è¯•è¦æ±‚

**å‰ç«¯éªŒæ”¶**ï¼š
- æ˜µç§°ä¸ºç©º â†’ æ˜¾ç¤ºé”™è¯¯æç¤º"è¯·è¾“å…¥æ˜µç§°"
- é‚€è¯·ç æ— æ•ˆ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º"èšä¼šä¸å­˜åœ¨"
- åŠ å…¥æˆåŠŸ â†’ è·³è½¬ Dashboardï¼Œæ˜¾ç¤ºèšä¼šä¿¡æ¯

**åç«¯æµ‹è¯•ç”¨ä¾‹**ï¼š
- æ­£å¸¸åŠ å…¥ â†’ 201 + participant å¯¹è±¡
- é‡å¤åŠ å…¥ â†’ 400 ALREADY_JOINED
- èšä¼šä¸å­˜åœ¨ â†’ 404 NOT_FOUND
- èšä¼šå·²å®Œæˆ â†’ 400 INVALID_STATE
- èšä¼šäººæ•°å·²æ»¡ â†’ 400 GATHERING_FULL

---

### 3.4 æåé¤å…ï¼ˆæ ¸å¿ƒå˜æ›´ï¼‰

#### åœºæ™¯æè¿°

è¿™æ˜¯ v2 æœ€å¤§çš„å˜åŒ–ã€‚èšä¼šè¿›å…¥ `nominating` çŠ¶æ€åï¼Œæ¯ä¸ªå‚ä¸è€…å¯ä»¥æå 1-2 å®¶é¤å…ã€‚æåæ–¹å¼æœ‰ä¸¤ç§ï¼š

1. **æ‰‹åŠ¨æŒ‡å®š**ï¼šæœç´¢é¤å…åç§°/åœ°å€ï¼ˆè°ƒç”¨é«˜å¾· POI æœç´¢ï¼‰ï¼Œä»æœç´¢ç»“æœä¸­é€‰æ‹©
2. **AI æ¨è**ï¼šå¡«å†™è‡ªå·±çš„å£å‘³åå¥½ â†’ ç³»ç»ŸåŸºäºè¯¥å‚ä¸è€…çš„ä½ç½®+å£å‘³+æ‰€æœ‰äººä½ç½®ä¸­å¿ƒç‚¹ï¼Œæ¨è 3 å®¶é¤å… â†’ å‚ä¸è€…ä»ä¸­é€‰æ‹© 1-2 å®¶ä½œä¸ºæå

**çŠ¶æ€æµè½¬**ï¼šå‘èµ·äººç‚¹å‡»"å¼€å§‹æå"â†’ èšä¼šçŠ¶æ€ä» `waiting` åˆ‡æ¢åˆ° `nominating`

#### UI éœ€æ±‚

**é¡µé¢åŒºåŸŸ**ï¼šDashboard ä¸»å†…å®¹åŒºçš„ `NominationSection`

**å­ç»„ä»¶ç»“æ„**ï¼š
```
NominationSection
â”œâ”€â”€ NominationHeader                    // æ ‡é¢˜ + æåè¿›åº¦ï¼ˆ3/5äººå·²æåï¼‰
â”œâ”€â”€ MyNominationPanel                  // å½“å‰ç”¨æˆ·çš„æåæ“ä½œåŒº
â”‚   â”œâ”€â”€ NominationMethodTabs           // Tab åˆ‡æ¢ï¼šæ‰‹åŠ¨æœç´¢ / AI æ¨è
â”‚   â”œâ”€â”€ RestaurantSearchPanel           // æ‰‹åŠ¨æœç´¢æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ SearchInput                 // æœç´¢æ¡†ï¼ˆå…³é”®è¯ï¼‰
â”‚   â”‚   â””â”€â”€ SearchResultList           // æœç´¢ç»“æœåˆ—è¡¨ï¼Œæ¯é¡¹å¯ç‚¹å‡»"æå"
â”‚   â””â”€â”€ AiSuggestPanel                  // AI æ¨èæ¨¡å¼
â”‚       â”œâ”€â”€ TasteSelector               // å£å‘³åå¥½é€‰æ‹©ï¼ˆä»…æ­¤å¤„ä½¿ç”¨ï¼‰
â”‚       â”œâ”€â”€ AiSuggestButton             // "è·å– AI æ¨è"æŒ‰é’®
â”‚       â””â”€â”€ AiSuggestResults            // AI æ¨èç»“æœï¼ˆæœ€å¤š 3 å®¶ï¼‰ï¼Œæ¯é¡¹å¯ç‚¹å‡»"æå"
â”œâ”€â”€ NominationList                      // æ‰€æœ‰äººçš„æååˆ—è¡¨
â”‚   â””â”€â”€ NominationCard[]                // æ¯å¼ æåå¡ç‰‡ï¼šé¤å…ä¿¡æ¯ + æåäºº + æåæ¥æºæ ‡ç­¾
â””â”€â”€ StartVotingButton                   // å‘èµ·äººå¯è§ï¼šå¼€å§‹æŠ•ç¥¨ï¼ˆéœ€è‡³å°‘ 2 ä¸ªæåï¼‰
```

**äº¤äº’ç»†èŠ‚**ï¼š
- Tab é»˜è®¤é€‰ä¸­"æ‰‹åŠ¨æœç´¢"
- æœç´¢æ¡†ï¼šè¾“å…¥å…³é”®è¯ â†’ é˜²æŠ– 300ms â†’ è°ƒç”¨é«˜å¾· POI æœç´¢ â†’ æ˜¾ç¤ºç»“æœåˆ—è¡¨
- æœç´¢ç»“æœæ¯é¡¹æ˜¾ç¤ºï¼šé¤å…åã€åœ°å€ã€èœç³»ã€è¯„åˆ†ã€äººå‡ã€è·ç¦»ï¼ˆåˆ°ä¸­å¿ƒç‚¹ï¼‰
- ç‚¹å‡»"æå"â†’ è°ƒç”¨æå API â†’ æåæˆåŠŸååˆ·æ–°æååˆ—è¡¨
- AI æ¨èæ¨¡å¼ï¼šå…ˆé€‰å£å‘³æ ‡ç­¾ï¼ˆå¤ç”¨ TasteSelectorï¼‰â†’ ç‚¹å‡»"è·å–æ¨è"â†’ æ˜¾ç¤º 3 å®¶æ¨è â†’ é€‰æ‹©æå
- æ¯äººæœ€å¤šæå 2 å®¶ï¼Œå·²æå 2 å®¶åæŒ‰é’®ç¦ç”¨
- æååˆ—è¡¨ï¼šå¡ç‰‡å¼å¸ƒå±€ï¼Œæ˜¾ç¤ºæåäººå¤´åƒ+æ˜µç§°ã€é¤å…ä¿¡æ¯ã€æ¥æºæ ‡ç­¾ï¼ˆ"æ‰‹åŠ¨" / "AIæ¨è"ï¼‰
- å‘èµ·äººå¯è§"å¼€å§‹æŠ•ç¥¨"æŒ‰é’®ï¼Œç‚¹å‡»åèšä¼šçŠ¶æ€åˆ‡æ¢åˆ° `voting`

#### åç«¯éœ€æ±‚

**API 1: å¼€å§‹æåé˜¶æ®µ**

`POST /api/gatherings/:code/start-nominating`

- è¯·æ±‚ä½“ï¼šæ— 
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºå‘èµ·äººã€èšä¼šçŠ¶æ€ä¸º `waiting`ã€å‚ä¸è€… â‰¥ 2
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{ success: true; data: { status: "nominating" }; }
```
- é”™è¯¯ç ï¼š`FORBIDDEN` | `INVALID_STATE` | `TOO_FEW_PARTICIPANTS`

---

**API 2: æœç´¢é¤å…ï¼ˆPOI æœç´¢ï¼‰**

`GET /api/gatherings/:code/search-restaurants?keyword=ç«é”…&page=1`

- æŸ¥è¯¢å‚æ•°ï¼š
  - `keyword`ï¼ˆå¿…å¡«ï¼‰ï¼šæœç´¢å…³é”®è¯
  - `page`ï¼ˆå¯é€‰ï¼‰ï¼šé¡µç ï¼Œé»˜è®¤ 1
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºèšä¼šå‚ä¸è€…
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    restaurants: [{
      amap_id: string;
      name: string;
      type: string;
      address: string;
      location: { lng: number; lat: number };
      rating: number | null;
      cost: number | null;
      distance_to_center: number;
      photo_url: string | null;
    }];
    total: number;
    page: number;
  };
}
```

---

**API 3: AI æ¨èï¼ˆä¸ªäººç»´åº¦ï¼‰**

`POST /api/gatherings/:code/ai-suggest`

- è¯·æ±‚ä½“ï¼š
```typescript
{
  tastes: string[];   // å½“å‰ç”¨æˆ·çš„å£å‘³åå¥½ï¼Œ1-5 ä¸ª
}
```
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºèšä¼šå‚ä¸è€…ã€èšä¼šçŠ¶æ€ä¸º `nominating`ã€è°ƒç”¨è€…æœ‰ä½ç½®ä¿¡æ¯
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    suggestions: [{
      amap_id: string;
      name: string;
      type: string;
      address: string;
      location: { lng: number; lat: number };
      rating: number | null;
      cost: number | null;
      score: number;
      reason: string;
      travel_infos: [{
        participant_id: string;
        nickname: string;
        distance: number;
        duration: number;
      }];
    }];  // æœ€å¤š 3 å®¶
  };
}
```

---

**API 4: æåé¤å…**

`POST /api/gatherings/:code/nominate`

- è¯·æ±‚ä½“ï¼š
```typescript
{
  amap_id: string;           // é«˜å¾· POI ID
  name: string;              // é¤å…åç§°
  type?: string;             // èœç³»
  address?: string;          // åœ°å€
  location: { lng: number; lat: number };
  rating?: number;           // è¯„åˆ†
  cost?: number;             // äººå‡
  source: "manual" | "ai";  // æåæ¥æº
}
```
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºèšä¼šå‚ä¸è€…ã€èšä¼šçŠ¶æ€ä¸º `nominating`ã€å½“å‰ç”¨æˆ·æåæ•° < 2ã€ä¸èƒ½é‡å¤æååŒä¸€å®¶é¤å…
- å“åº”ï¼ˆ201ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    id: string;
    gathering_id: string;
    nominated_by: string;
    nominator_nickname: string;
    amap_id: string;
    name: string;
    type: string | null;
    address: string | null;
    location: { lng: number; lat: number };
    rating: number | null;
    cost: number | null;
    source: "manual" | "ai";
    travel_infos: TravelInfo[];
    created_at: string;
  };
}
```
- é”™è¯¯ç ï¼š`INVALID_STATE` | `NOT_JOINED` | `NOMINATION_LIMIT` | `DUPLICATE_NOMINATION`

---

**API 5: æ’¤å›æå**

`DELETE /api/gatherings/:code/nominate/:nominationId`

- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºè¯¥æåçš„æåäººã€èšä¼šçŠ¶æ€ä¸º `nominating`
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{ success: true; data: { deleted: true }; }
```
- é”™è¯¯ç ï¼š`FORBIDDEN` | `NOT_FOUND` | `INVALID_STATE`

#### å‰ç«¯éœ€æ±‚

**æ–°å¢ç»„ä»¶**ï¼š
- `NominationSection` â€” æåé˜¶æ®µä¸»å®¹å™¨
- `NominationMethodTabs` â€” Tab ç»„ä»¶ï¼ˆæ‰‹åŠ¨/AIï¼‰
- `RestaurantSearchPanel` â€” æœç´¢é¢æ¿
  - state: `{ keyword, results, searching }`
  - é˜²æŠ–æœç´¢ hook: `useDebounce(keyword, 300)`
- `AiSuggestPanel` â€” AI æ¨èé¢æ¿
  - state: `{ selectedTastes, suggestions, loading }`
- `NominationCard` â€” æåå¡ç‰‡
  - props: `{ nomination: Nomination, participants: Participant[] }`
- `NominationList` â€” æååˆ—è¡¨
- `StartVotingButton` â€” å¼€å§‹æŠ•ç¥¨æŒ‰é’®ï¼ˆä»…å‘èµ·äººå¯è§ï¼‰

**Store æ–°å¢ Actions**ï¼š
```typescript
interface GatheringActions {
  startNominating: (code: string) => Promise<void>;
  searchRestaurants: (code: string, keyword: string) => Promise<SearchResult[]>;
  aiSuggest: (code: string, tastes: string[]) => Promise<Suggestion[]>;
  nominate: (code: string, restaurant: NominateParams) => Promise<void>;
  withdrawNomination: (code: string, nominationId: string) => Promise<void>;
  startVoting: (code: string) => Promise<void>;
}
```

#### æµ‹è¯•è¦æ±‚

**å‰ç«¯éªŒæ”¶**ï¼š
- æœç´¢è¾“å…¥ â†’ é˜²æŠ–åæ˜¾ç¤ºç»“æœåˆ—è¡¨
- ç‚¹å‡»"æå"â†’ æåæˆåŠŸ â†’ æååˆ—è¡¨æ›´æ–° â†’ æŒ‰é’®å˜ä¸º"å·²æå"
- å·²æå 2 å®¶ â†’ æåæŒ‰é’®ç¦ç”¨ï¼Œæ˜¾ç¤º"å·²è¾¾ä¸Šé™"
- AI æ¨èï¼šé€‰æ‹©å£å‘³ â†’ ç‚¹å‡»æ¨è â†’ æ˜¾ç¤º 3 å®¶ç»“æœ
- æ’¤å›æå â†’ æååˆ—è¡¨ç§»é™¤è¯¥é¡¹

**åç«¯æµ‹è¯•ç”¨ä¾‹**ï¼š
- `POST /nominate` æ­£å¸¸æå â†’ 201
- æåè¶…è¿‡ 2 å®¶ â†’ 400 NOMINATION_LIMIT
- é‡å¤æååŒä¸€é¤å… â†’ 400 DUPLICATE_NOMINATION
- é nominating çŠ¶æ€ â†’ 400 INVALID_STATE
- `GET /search-restaurants` è¿”å› POI åˆ—è¡¨
- `POST /ai-suggest` è¿”å› 3 å®¶æ¨è
- `DELETE /nominate/:id` æ’¤å›æˆåŠŸ â†’ 200

---

### 3.5 æŠ•ç¥¨ç¡®è®¤

#### åœºæ™¯æè¿°

v2 æŠ•ç¥¨æœºåˆ¶ä»"å¯¹å•ä¸ªé¤å…åŒæ„/åå¯¹"æ”¹ä¸º"ä»æ‰€æœ‰æåä¸­é€‰æ‹©æœ€å–œæ¬¢çš„"ã€‚æ¯äººæŠ• 1 ç¥¨ï¼ˆé€‰æ‹©åˆ¶ï¼‰ï¼Œå¾—ç¥¨æœ€å¤šçš„é¤å…èƒœå‡ºã€‚

**çŠ¶æ€æµè½¬**ï¼šå‘èµ·äººç‚¹å‡»"å¼€å§‹æŠ•ç¥¨"â†’ èšä¼šçŠ¶æ€ä» `nominating` â†’ `voting`

#### UI éœ€æ±‚

**ç»„ä»¶ç»“æ„**ï¼š
```
VotingSection
â”œâ”€â”€ VotingHeader                    // "æŠ•ç¥¨è¿›è¡Œä¸­" + å€’è®¡æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰
â”œâ”€â”€ VoteNominationGrid             // æ‰€æœ‰æåçš„ç½‘æ ¼/åˆ—è¡¨
â”‚   â””â”€â”€ VoteNominationCard[]       // æ¯å¼ å¡ç‰‡ï¼šé¤å…ä¿¡æ¯ + æåäºº + å¾—ç¥¨æ•° + "æŠ•ç¥¨"æŒ‰é’®
â”œâ”€â”€ VoteResultBar                  // å®æ—¶æŠ•ç¥¨è¿›åº¦æ¡
â””â”€â”€ VoteStatusFooter               // å·²æŠ•ç¥¨/æœªæŠ•ç¥¨çŠ¶æ€
```

**äº¤äº’**ï¼š
- æ¯ä¸ªæåå¡ç‰‡æ˜¾ç¤ºï¼šé¤å…åã€èœç³»ã€è¯„åˆ†ã€äººå‡ã€æåäººã€å½“å‰å¾—ç¥¨æ•°
- æ¯äººåªèƒ½æŠ• 1 ç¥¨ï¼Œç‚¹å‡»"æŠ•è¿™å®¶"â†’ è¯¥å¡ç‰‡é«˜äº® + å…¶ä»–å¡ç‰‡æŒ‰é’®ç¦ç”¨
- æŠ•ç¥¨æœ‰ 10 åˆ†é’Ÿè¶…æ—¶
- å…¨å‘˜æŠ•ç¥¨å®Œæˆ æˆ– è¶…æ—¶ â†’ è‡ªåŠ¨ç»“ç®—
- ç»“ç®—è§„åˆ™ï¼šå¾—ç¥¨æœ€å¤šçš„é¤å…èƒœå‡ºï¼›å¹³ç¥¨æ—¶å–ç»¼åˆè¯„åˆ†æ›´é«˜çš„ï¼›ä»å¹³ç¥¨å–æœ€æ—©æåçš„
- æŠ•ç¥¨ç»“æœåŠ¨ç”»ï¼šèƒœå‡ºé¤å…å¡ç‰‡æ”¾å¤§ + ğŸ‰ æ•ˆæœ

#### åç«¯éœ€æ±‚

**API 6: å¼€å§‹æŠ•ç¥¨**

`POST /api/gatherings/:code/start-voting`

- è¯·æ±‚ä½“ï¼šæ— 
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºå‘èµ·äººã€èšä¼šçŠ¶æ€ä¸º `nominating`ã€æåæ•° â‰¥ 2
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    vote: {
      id: string;
      gathering_id: string;
      status: "active";
      timeout_at: string;       // 10 åˆ†é’Ÿå
      total_participants: number;
      nominations: string[];    // å‚ä¸æŠ•ç¥¨çš„ nomination IDs
      created_at: string;
    };
  };
}
```
- é”™è¯¯ç ï¼š`FORBIDDEN` | `INVALID_STATE` | `TOO_FEW_NOMINATIONS`

---

**API 7: æŠ•ç¥¨ï¼ˆé€‰æ‹©åˆ¶ï¼‰**

`POST /api/gatherings/:code/vote/:voteId`

- è¯·æ±‚ä½“ï¼ˆv2 æ”¹ä¸ºé€‰æ‹©åˆ¶ï¼‰ï¼š
```typescript
{
  nomination_id: string;   // é€‰æ‹©çš„æå IDï¼ˆæ›¿ä»£ v1 çš„ agree: booleanï¼‰
}
```
- å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…ä¸ºèšä¼šå‚ä¸è€…ã€æŠ•ç¥¨çŠ¶æ€ä¸º activeã€æœªè¶…æ—¶ã€æœªæŠ•è¿‡ç¥¨
- å“åº”ï¼ˆ200ï¼‰ï¼š
```typescript
{
  success: true;
  data: {
    vote_counts: [
      { nomination_id: string; name: string; count: number; }
    ];
    total_voted: number;
    total_participants: number;
    result: null | {
      winner_nomination_id: string;
      winner_name: string;
    };
  };
}
```

**ç»“ç®—é€»è¾‘**ï¼š
- `total_voted === total_participants` â†’ è‡ªåŠ¨ç»“ç®—
- è¶…æ—¶ â†’ è‡ªåŠ¨ç»“ç®—ï¼ˆpoll è§¦å‘ï¼‰
- ç»“ç®—ï¼šå¾—ç¥¨æœ€å¤šè€…èƒœå‡ºï¼›å¹³ç¥¨å– nomination ä¸­ score æœ€é«˜çš„ï¼›ä»å¹³ç¥¨å–æœ€æ—©æåçš„
- èƒœå‡ºåï¼šUPDATE `nominations` SET is_confirmed=trueï¼ŒUPDATE `gatherings` SET status='confirmed'

- é”™è¯¯ç ï¼š`ALREADY_VOTED` | `VOTE_ENDED` | `NOT_JOINED` | `INVALID_NOMINATION`

#### å‰ç«¯éœ€æ±‚

- **ç»„ä»¶**ï¼š`VotingSection` â€” å®Œå…¨é‡å†™
  - ä» v1 çš„"åŒæ„/åå¯¹"æ”¹ä¸º"é€‰æ‹©æœ€å–œæ¬¢çš„æå"
  - æ˜¾ç¤ºæ‰€æœ‰æåå¡ç‰‡ + æŠ•ç¥¨æŒ‰é’®
- **ç»„ä»¶**ï¼š`VoteNominationCard` â€” æ–°ç»„ä»¶
  - props: `{ nomination, voteCount, isSelected, onVote, disabled }`

#### æµ‹è¯•è¦æ±‚

**å‰ç«¯éªŒæ”¶**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰æå â†’ æ¯å¼ å¡ç‰‡æœ‰"æŠ•è¿™å®¶"æŒ‰é’®
- ç‚¹å‡»æŠ•ç¥¨ â†’ è¯¥å¡ç‰‡é«˜äº® â†’ å…¶ä»–æŒ‰é’®ç¦ç”¨
- å·²æŠ•ç¥¨ â†’ æ˜¾ç¤º"ä½ å·²æŠ•ç¥¨"
- å€’è®¡æ—¶å½’é›¶ â†’ æ˜¾ç¤ºç»“æœ

**åç«¯æµ‹è¯•ç”¨ä¾‹**ï¼š
- `POST /start-voting` æå < 2 â†’ 400 TOO_FEW_NOMINATIONS
- `POST /vote/:voteId` æ­£å¸¸æŠ•ç¥¨ â†’ 200 + ç¥¨æ•°ç»Ÿè®¡
- é‡å¤æŠ•ç¥¨ â†’ 400 ALREADY_VOTED
- å…¨å‘˜æŠ•å®Œ â†’ è‡ªåŠ¨ç»“ç®— + è¿”å› winner
- è¶…æ—¶ç»“ç®— â†’ poll è§¦å‘

---

### 3.6 å‡ºå‘æ—¶é—´ç®¡ç†

#### åœºæ™¯æè¿°

é¤å…ç¡®è®¤åï¼Œç³»ç»Ÿè®¡ç®—æ¯ä¸ªå‚ä¸è€…çš„å»ºè®®å‡ºå‘æ—¶é—´ã€‚ä¸ v1 é€»è¾‘ä¸€è‡´ï¼Œæ–°å¢ `departing` çŠ¶æ€ã€‚

**çŠ¶æ€æµè½¬**ï¼š`confirmed` â†’ ç¬¬ä¸€ä¸ªäººå‡ºå‘ â†’ `departing` â†’ å…¨å‘˜åˆ°è¾¾ â†’ `completed`

#### UI éœ€æ±‚

æ²¿ç”¨ v1 çš„ `ActionBar` + `ConfirmedSection`ï¼Œå˜åŒ–ï¼š
- ç¡®è®¤çš„é¤å…ä¿¡æ¯æ¥è‡ª `nominations` è¡¨ï¼ˆis_confirmed=trueï¼‰è€Œé `restaurants` è¡¨
- æ˜¾ç¤ºæåäººä¿¡æ¯ï¼š"ç”± XX æå"

#### åç«¯éœ€æ±‚

æ²¿ç”¨ v1ï¼ŒçŠ¶æ€æ£€æŸ¥æ›´æ–°ï¼š
- `POST /api/gatherings/:code/depart` â€” æ ‡è®°å‡ºå‘
- `POST /api/gatherings/:code/arrive` â€” æ ‡è®°åˆ°è¾¾
- v2 å˜åŒ–ï¼š
  - çŠ¶æ€æ£€æŸ¥ï¼š`confirmed` æˆ– `departing`
  - ç¬¬ä¸€ä¸ªäººå‡ºå‘ â†’ èšä¼šçŠ¶æ€ä» `confirmed` â†’ `departing`

#### å‰ç«¯éœ€æ±‚

æ²¿ç”¨ v1 çš„ `ActionBar`ï¼ŒçŠ¶æ€åˆ¤æ–­æ”¹ä¸º `departing`

#### æµ‹è¯•è¦æ±‚

æ²¿ç”¨ v1 æµ‹è¯•ç”¨ä¾‹ï¼ŒçŠ¶æ€åç§°æ›´æ–°

---

### 3.7 åˆ°è¾¾ä¸å®Œæˆ

#### åœºæ™¯æè¿°

ä¸ v1 ä¸€è‡´ã€‚å…¨å‘˜åˆ°è¾¾ â†’ èšä¼šå®Œæˆã€‚

#### UI éœ€æ±‚

æ²¿ç”¨ v1

#### åç«¯éœ€æ±‚

æ²¿ç”¨ v1ï¼ŒçŠ¶æ€åç§° `active` â†’ `departing`

#### å‰ç«¯éœ€æ±‚

æ²¿ç”¨ v1

#### æµ‹è¯•è¦æ±‚

æ²¿ç”¨ v1

---

## 4. åŠŸèƒ½æ¸…å•ï¼ˆP0/P1/P2 åˆ†çº§ï¼‰

### P0 â€” æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVP v2ï¼‰

| ç¼–å· | åŠŸèƒ½ | è¯´æ˜ | v1 å¯¹æ¯” |
|------|------|------|---------|
| P0-1 | åˆ›å»ºèšä¼š | åç§°+æ—¶é—´ï¼Œç”Ÿæˆé‚€è¯·ç  | ç®€åŒ–ï¼ˆç§»é™¤å£å‘³ï¼‰ |
| P0-2 | åŠ å…¥èšä¼š | æ˜µç§°+è‡ªåŠ¨å®šä½ | ç®€åŒ–ï¼ˆç§»é™¤å£å‘³ï¼‰ |
| P0-3 | æ‰‹åŠ¨æåé¤å… | POI æœç´¢ + æå | ğŸ†• æ›¿ä»£ AI æ¨è |
| P0-4 | AI æ¨èæå | åŸºäºä½ç½®+å£å‘³æ¨èé¤å… | ğŸ†• æ›¿ä»£å…¨å±€ AI æ¨è |
| P0-5 | æ’¤å›æå | æåäººå¯æ’¤å›è‡ªå·±çš„æå | ğŸ†• æ–°å¢ |
| P0-6 | æŠ•ç¥¨ç¡®è®¤ | é€‰æ‹©åˆ¶æŠ•ç¥¨ï¼Œå¾—ç¥¨æœ€å¤šè€…èƒœ | é‡æ„ï¼ˆä»åŒæ„/åå¯¹æ”¹ä¸ºé€‰æ‹©ï¼‰ |
| P0-7 | å‡ºå‘è¿½è¸ª | æ ‡è®°å‡ºå‘/åˆ°è¾¾ï¼Œå®æ—¶çŠ¶æ€æ˜¾ç¤º | æ²¿ç”¨ |
| P0-8 | æ™ºèƒ½å‚¬ä¿ƒ | è¶…æ—¶æœªå‡ºå‘æ˜¾ç¤ºå‚¬ä¿ƒæ¶ˆæ¯ | æ²¿ç”¨ |
| P0-9 | æ¸¸å®¢æ¨¡å¼ | æ— éœ€æ³¨å†Œï¼Œè¾“å…¥æ˜µç§°å³å¯ä½¿ç”¨ | æ²¿ç”¨ |

### P1 â€” å¢å¼ºåŠŸèƒ½

| ç¼–å· | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| P1-1 | æš—è‰²æ¨¡å¼ | æ¸©æš–è‰²è°ƒçš„æš—è‰²ä¸»é¢˜ |
| P1-2 | èšä¼šå†å² | æŸ¥çœ‹è¿‡å»å‚ä¸çš„èšä¼šè®°å½• |
| P1-3 | å¾®ä¿¡å°ç¨‹åº | å°ç¨‹åºç«¯å®Œæ•´åŠŸèƒ½ |
| P1-4 | åœ°å›¾å¯è§†åŒ– | åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºæ‰€æœ‰äººä½ç½®å’Œé¤å… |
| P1-5 | åˆ†äº«å¡ç‰‡ | ç”Ÿæˆå¥½çœ‹çš„èšä¼šåˆ†äº«å›¾ç‰‡ |

### P2 â€” æ‰©å±•åŠŸèƒ½

| ç¼–å· | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| P2-1 | å¾®ä¿¡æ‰«ç ç™»å½• | Web ç«¯å¾®ä¿¡æ‰«ç ç™»å½• |
| P2-2 | è®¢é˜…æ¶ˆæ¯æ¨é€ | å°ç¨‹åºè®¢é˜…æ¶ˆæ¯é€šçŸ¥ |
| P2-3 | æ”¶è—é¤å… | æ”¶è—å–œæ¬¢çš„é¤å…ï¼Œä¸‹æ¬¡æ¨èä¼˜å…ˆ |
| P2-4 | èšä¼šæ¨¡æ¿ | ä¿å­˜å¸¸ç”¨èšä¼šé…ç½®ï¼Œä¸€é”®å¤ç”¨ |
| P2-5 | è´¹ç”¨ AA | èšé¤å AA åˆ†è´¦ |

---

## 5. çŠ¶æ€æœºå®šä¹‰

### èšä¼šçŠ¶æ€

```
waiting â†’ nominating â†’ voting â†’ confirmed â†’ departing â†’ completed
    â†‘          â†“            â†“          â†“           â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              ï¼ˆå¯é‡æ–°å¼€å§‹æå/æŠ•ç¥¨ï¼‰
```

| çŠ¶æ€ | è¯´æ˜ | å…è®¸çš„æ“ä½œ |
|------|------|------------|
| `waiting` | ç­‰å¾…å‚ä¸è€…åŠ å…¥ | join, start-nominating |
| `nominating` | æåé˜¶æ®µ | nominate, withdraw-nomination, ai-suggest, start-voting |
| `voting` | æŠ•ç¥¨è¿›è¡Œä¸­ | vote |
| `confirmed` | é¤å…å·²ç¡®è®¤ | depart |
| `departing` | æœ‰äººå·²å‡ºå‘ | depart, arrive |
| `completed` | å…¨å‘˜åˆ°è¾¾ï¼Œèšä¼šå®Œæˆ | ï¼ˆæ— ï¼‰ |

### å‚ä¸è€…çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| `joined` | å·²åŠ å…¥ |
| `departed` | å·²å‡ºå‘ |
| `arrived` | å·²åˆ°è¾¾ |

---

## 6. ä¸åšæ¸…å•ï¼ˆYAGNIï¼‰

ä»¥ä¸‹åŠŸèƒ½åœ¨ v2 é˜¶æ®µ**ä¸åš**ï¼š

1. ~~å‘èµ·äººç»Ÿä¸€ AI æ¨èé¤å…~~ â†’ æ”¹ä¸ºæ¯äººç‹¬ç«‹æå
2. ~~åŠ å…¥æ—¶å¼ºåˆ¶å¡«å†™å£å‘³åå¥½~~ â†’ å£å‘³ä»…åœ¨ AI æ¨èæ—¶æŒ‰éœ€å¡«å†™
3. ~~å¤šè½®æŠ•ç¥¨ï¼ˆæ¯è½®æ·˜æ±°ï¼‰~~ â†’ å•è½®æŠ•ç¥¨ï¼Œå¾—ç¥¨æœ€å¤šè€…èƒœ
4. ~~é¤å…æ”¶è—åŠŸèƒ½~~ â†’ P2 é˜¶æ®µ
5. ~~è´¹ç”¨ AA åˆ†è´¦~~ â†’ P2 é˜¶æ®µ
6. ~~èšä¼šæ¨¡æ¿~~ â†’ P2 é˜¶æ®µ
7. ~~å¾®ä¿¡æ‰«ç ç™»å½• Web ç«¯~~ â†’ P2 é˜¶æ®µ
8. ~~å°ç¨‹åºè®¢é˜…æ¶ˆæ¯~~ â†’ P2 é˜¶æ®µ

---

## 7. éåŠŸèƒ½éœ€æ±‚

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| **æ€§èƒ½** | é¡µé¢åŠ è½½ < 2sï¼ŒAPI å“åº” < 500ms |
| **å¹¶å‘** | æ”¯æŒå•èšä¼š 10 äººåŒæ—¶åœ¨çº¿ |
| **å¯ç”¨æ€§** | æ¸¸å®¢æ¨¡å¼é›¶é—¨æ§›ï¼Œæ ¸å¿ƒæµç¨‹ 3 æ­¥å†…å®Œæˆ |
| **å…¼å®¹æ€§** | Web æ”¯æŒ Chrome/Safari/å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼›å°ç¨‹åºæ”¯æŒ iOS/Android |
| **å®‰å…¨** | èšä¼šæ•°æ®ä»…å‚ä¸è€…å¯è§ï¼Œé‚€è¯·ç æœ‰æ•ˆæœŸ 24 å°æ—¶ |
| **ç§»åŠ¨ç«¯** | Mobile Firstï¼Œè§¦æ‘¸å‹å¥½ |

---

## 8. æ•°æ®æŒ‡æ ‡

### æ ¸å¿ƒæŒ‡æ ‡

- **èšä¼šå®Œæˆç‡**ï¼šåˆ›å»ºèšä¼š â†’ å…¨å‘˜åˆ°è¾¾çš„è½¬åŒ–ç‡
- **åŠ å…¥è½¬åŒ–ç‡**ï¼šæ”¶åˆ°é‚€è¯·ç  â†’ æˆåŠŸåŠ å…¥çš„æ¯”ä¾‹
- **æåå‚ä¸ç‡**ï¼šå‘èµ·æååï¼Œè‡³å°‘æœ‰ 1 äººæåçš„æ¯”ä¾‹
- **æŠ•ç¥¨å‚ä¸ç‡**ï¼šå‘èµ·æŠ•ç¥¨åï¼Œå…¨å‘˜æŠ•ç¥¨å®Œæˆçš„æ¯”ä¾‹

### æ¬¡è¦æŒ‡æ ‡

- å¹³å‡æ¯èšä¼šå‚ä¸äººæ•°
- ä»åˆ›å»ºåˆ°å…¨å‘˜åˆ°è¾¾çš„å¹³å‡æ—¶é•¿
- ç”¨æˆ·å¤è®¿ç‡ï¼ˆå†æ¬¡åˆ›å»º/åŠ å…¥èšä¼šï¼‰
- æ‰‹åŠ¨æå vs AI æåçš„æ¯”ä¾‹

---

## é™„å½• Aï¼šAPI æ¥å£æ¸…å•

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/auth/guest | æ¸¸å®¢ç™»å½• |
| POST | /api/auth/wechat | å¾®ä¿¡ç™»å½• |

### èšä¼šæ¥å£

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| POST | /api/gatherings | åˆ›å»ºèšä¼š |
| GET | /api/gatherings/:code | è·å–èšä¼šè¯¦æƒ… |
| GET | /api/gatherings/mine | æˆ‘çš„èšä¼šåˆ—è¡¨ |
| POST | /api/gatherings/:code/join | åŠ å…¥èšä¼š |
| POST | /api/gatherings/:code/start-nominating | å¼€å§‹æåé˜¶æ®µ |
| POST | /api/gatherings/:code/start-voting | å¼€å§‹æŠ•ç¥¨é˜¶æ®µ |
| GET | /api/gatherings/:code/search-restaurants | POI æœç´¢ |
| POST | /api/gatherings/:code/ai-suggest | AI æ¨è |
| POST | /api/gatherings/:code/nominate | æåé¤å… |
| DELETE | /api/gatherings/:code/nominate/:id | æ’¤å›æå |
| POST | /api/gatherings/:code/vote/:voteId | æŠ•ç¥¨ |
| POST | /api/gatherings/:code/depart | æ ‡è®°å‡ºå‘ |
| POST | /api/gatherings/:code/arrive | æ ‡è®°åˆ°è¾¾ |
| GET | /api/gatherings/:code/poll | è½®è¯¢æ›´æ–° |

---

## é™„å½• Bï¼šé”™è¯¯ç è§„èŒƒ

| é”™è¯¯ç  | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|--------|-------------|------|
| `AUTH_REQUIRED` | 401 | æœªç™»å½• |
| `FORBIDDEN` | 403 | æ— æƒé™ |
| `NOT_FOUND` | 404 | èµ„æºä¸å­˜åœ¨ |
| `VALIDATION_ERROR` | 400 | å‚æ•°æ ¡éªŒå¤±è´¥ |
| `GATHERING_FULL` | 400 | èšä¼šäººæ•°å·²æ»¡ |
| `INVALID_STATE` | 400 | çŠ¶æ€ä¸å…è®¸æ­¤æ“ä½œ |
| `ALREADY_JOINED` | 400 | å·²åŠ å…¥è¯¥èšä¼š |
| `ALREADY_VOTED` | 400 | å·²æŠ•è¿‡ç¥¨ |
| `NOMINATION_LIMIT` | 400 | æåå·²è¾¾ä¸Šé™ï¼ˆ2ä¸ªï¼‰ |
| `DUPLICATE_NOMINATION` | 400 | é‡å¤æååŒä¸€é¤å… |
| `TOO_FEW_PARTICIPANTS` | 400 | å‚ä¸è€…ä¸è¶³ |
| `TOO_FEW_NOMINATIONS` | 400 | æåä¸è¶³ |
| `VOTE_ENDED` | 400 | æŠ•ç¥¨å·²ç»“æŸ |
| `NOT_PARTICIPANT` | 400 | éèšä¼šå‚ä¸è€… |
| `INTERNAL_ERROR` | 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

> æ–‡æ¡£ç‰ˆæœ¬ï¼šv2.0.0
> æœ€åæ›´æ–°ï¼š2026-02
> çŠ¶æ€ï¼šå¾…ç”¨æˆ·ç¡®è®¤
