# 开发计划总览 — 碰个头 (OnTheWay)

> 总计约 4-5 周 | 最后更新：2025-02

---

## 整体规划

```
Phase 1        Phase 2          Phase 3            Phase 4        Phase 5
基础设施 ──→ 核心聚会流程 ──→ 出发追踪+实时 ──→ 微信小程序 ──→ 优化+部署
 (2天)        (5-7天)          (5-7天)            (5-7天)        (3-5天)
```

---

## Phase 概览

### Phase 1：项目基础设施（预估 2 天）

**目标**：搭建完整的项目骨架，确保开发环境可用。

| Task | 内容 | 状态 |
|------|------|------|
| 1.1 | 项目初始化 — 目录结构、pnpm workspace、tsconfig、.gitignore、logo | ✅ |
| 1.2 | 设计 Token — design-tokens.json + Tailwind 配置 | ✅ |
| 1.3 | shared 包 — 类型定义、常量、工具函数 + 单元测试 | 进行中 |
| 1.4 | 文档体系 — CLAUDE.md、README、PRD、架构等全套文档 | 进行中 |
| 1.5 | Supabase 初始化 — 数据库 Schema、RLS 策略、种子数据 | 待开始 |

**验收标准**：`pnpm install && pnpm build:shared && pnpm test:shared` 全部通过。

📋 详细计划：[Phase 1 详细计划](./phase-1-foundation.md)

---

### Phase 2：核心聚会流程（预估 5-7 天）

**目标**：实现从创建聚会到投票确认的完整流程。

| Task | 内容 |
|------|------|
| 2.1 | 后端 API 基础 — Express 搭建、中间件、错误处理、认证 |
| 2.2 | 聚会 CRUD API — 创建、加入、查询接口 |
| 2.3 | AI 推荐 API — 高德 POI 搜索 + AI 排序推荐 |
| 2.4 | 投票 API — 发起投票、投票、结果判定 |
| 2.5 | Web 基础 — Vite + React + Router + Tailwind + Zustand 搭建 |
| 2.6 | 首页 — 创建聚会 / 输入邀请码 |
| 2.7 | 聚会详情页 — 参与者列表、推荐结果、投票 |
| 2.8 | 加入聚会页 — 填写信息、位置选择、口味选择 |

**验收标准**：可以完成 创建聚会 → 分享邀请码 → 加入 → AI 推荐 → 投票确认 的完整流程。

📋 详细计划：[Phase 2 详细计划](./phase-2-backend.md)

---

### Phase 3：出发追踪 + 实时功能（预估 5-7 天）

**目标**：实现出发追踪、实时同步、智能催促、暗色模式。

| Task | 内容 |
|------|------|
| 3.1 | 出发追踪 API — 标记出发/到达、计算出发时间 |
| 3.2 | 实时同步 — Supabase Realtime 订阅 + 轮询接口 |
| 3.3 | 催促系统 — 超时检测、催促消息生成 |
| 3.4 | 出发追踪 UI — 状态面板、倒计时、进度展示 |
| 3.5 | 暗色模式 — 主题切换、全组件适配 |
| 3.6 | 我的聚会 — 历史记录列表页 |
| 3.7 | 整体联调 — 全流程端到端测试 |

**验收标准**：完整流程可走通，实时同步正常，暗色模式可切换。

📋 详细计划：[Phase 3 详细计划](./phase-3-web.md)

---

### Phase 4：微信小程序（预估 5-7 天）

**目标**：开发微信小程序客户端，实现与 Web 端一致的核心功能。

| Task | 内容 |
|------|------|
| 4.1 | 小程序项目初始化 — 目录结构、TypeScript 配置 |
| 4.2 | 微信登录 — wx.login + 后端 code2session |
| 4.3 | 首页 — 创建聚会 / 输入邀请码 |
| 4.4 | 聚会详情页 — 参与者、推荐、投票、出发追踪 |
| 4.5 | 轮询同步 — 定时 GET /poll 实现实时更新 |
| 4.6 | 小程序适配 — 地图组件、分享、导航 |

**验收标准**：小程序可完成完整聚会流程，与 Web 端数据互通。

📋 详细计划：[Phase 4 详细计划](./phase-4-miniprogram.md)

---

### Phase 5：优化打磨 + 部署上线（预估 3-5 天）

**目标**：性能优化、体验打磨、部署上线。

| Task | 内容 |
|------|------|
| 5.1 | 性能优化 — 代码分割、懒加载、图片优化 |
| 5.2 | 体验优化 — 加载状态、空状态、错误处理 |
| 5.3 | Vercel 部署 — Web + API 部署配置 |
| 5.4 | Supabase 生产环境 — 数据库迁移、RLS 验证 |
| 5.5 | 小程序提审 — 审核材料准备、提交审核 |
| 5.6 | 监控告警 — 错误监控、性能监控 |

**验收标准**：生产环境可访问，核心流程稳定运行。

📋 详细计划：[Phase 5 详细计划](./phase-5-polish.md)

---

## 时间线

```
第 1 周：Phase 1 (2天) + Phase 2 开始 (3天)
  ├─ Day 1-2:  基础设施搭建（shared 包、文档、Supabase）
  └─ Day 3-5:  后端 API + Web 基础搭建

第 2 周：Phase 2 完成 + Phase 3 开始
  ├─ Day 6-8:  核心页面开发（首页、聚会详情、加入）
  └─ Day 9-10: 出发追踪 API + 实时同步

第 3 周：Phase 3 完成
  ├─ Day 11-13: 追踪 UI + 暗色模式
  └─ Day 14:    全流程联调验证

第 4 周：Phase 4
  ├─ Day 15-17: 小程序基础 + 登录 + 首页
  └─ Day 18-20: 聚会详情 + 轮询 + 适配

第 5 周：Phase 5
  ├─ Day 21-23: 优化 + 部署
  └─ Day 24-25: 监控 + 小程序提审
```

---

## 验证标准

每个 Phase 完成后必须通过：

1. **功能验证**：所有 Task 的验收标准全部通过
2. **代码质量**：TypeScript 无类型错误，测试全部通过
3. **文档同步**：相关文档已更新
4. **可演示性**：能够展示当前阶段成果

---

## 风险与应对

| 风险 | 影响 | 应对策略 |
|------|------|----------|
| AI 推荐效果不佳 | 用户体验差 | 先用规则排序兜底，逐步优化 AI prompt |
| 高德 API 配额限制 | 推荐功能不可用 | 缓存 POI 结果，减少重复调用 |
| 小程序审核不通过 | Phase 4 延期 | 提前了解审核规则，预留修改时间 |
| Supabase Realtime 不稳定 | 实时同步失败 | Web 端增加轮询降级方案 |

---

## 依赖关系

```
Phase 1 ──→ Phase 2 ──→ Phase 3
                │              │
                └──→ Phase 4 ←─┘
                         │
                         ↓
                     Phase 5
```

- Phase 2 依赖 Phase 1 的基础设施（shared 包、Supabase Schema）
- Phase 3 依赖 Phase 2 的核心 API
- Phase 4 依赖 Phase 2 的 API（可与 Phase 3 并行开发）
- Phase 5 依赖所有前置 Phase

---

## 下一步

👉 开始 [Phase 1: 基础设施搭建](./phase-1-foundation.md)
